## Hello, mur!

#### Описание интерфейса

Интерфейс MUR IDE состоит из 10 основных элементов:
![](qrc:/images/mur_ide_elements_new.png)

* Кнопка переключения режимов [1] - локальное выполнение кода или выполнение кода на аппарате/режим телеуправления. При активном соединении с аппаратом иконка с ракетой будет зеленой, в противном случае красной.
* Кнопка запуска скрипта [2]. При нажатии на данную кнопку будет запущен текущий скрипт. Если выбран режим Local - скрипт запускается локально на вашем компьютере. Если выбран режим Robot то скрипт будет запущен удаленно на аппарате. Запуск скрипта отменяет режим телеуправления.
* Кнопка остановки скрипта [3]. При нажатии на данную кнопку будет остановлен запущенный скрипт. Если выбран режим Local - будет остановлен скрипт, запущенный на вашем компьютере. Если выбран режим Robot то остановится скрипт, запущенный удаленно.
* Новый документ [4]. При нажатие на данную кнопку редактор кода будет очищен, изменения не сохранятся и будет создан виртуальный новый файл.
* Сохранить текущий документ [5]. При нажатие на данную кнопку текущий скрипт будет сохранен. Если вы сохраняете виртуальный файл, то появится диалоговое окно с предложением выбрать место куда ваш файл должен быть сохранен.
* Открыть документ [6]. При нажатие на данную кнопку появится диалоговое окно с предложением выбрать какой файл с кодом открыть.
* Запуск режима телеуправления [7]. Вы можете запустить данный режим только перейдя в режим Robot [1] и подключившись к аппарату. При активации данного режима во вкладке Remote [10] будут отображаться видеоизображения с камер аппарата, и вы сможете управлять аппаратом при помощи геймпада.
* Запуск симулятора [8]. При нажатие на данную кнопку откроется окно с симулятором.
* Включить/Выключить отображение телеметрии [9]. При нажатие на данную кнопку появится всплывающее окно с информацией о заряде батареи и показания с датчиков аппарата. Данная кнопка активна только при подключении к аппарату.
* Информационные вкладки [10]. Console - отображение системных сообщений о запуске/остановке программ, так же в это окно попадают сообщения из stderr и stdout скрипта, запущенного на аппарате при активном подключение. Help - окно с данным текстом. Remote - окно в котором будут отображаться видеоизображения в режиме телеуправления [7].

#### Подключение к аппарату

Все просто - вам нужно включить аппарат, подождать пока появится WiFi (mur_ssid), подключиться к нему (пароль по умолчанию vladivostok) и... Все готово!

#### Запись изображений с аппарата

В информационной вкладке Remote [10] отображается видео с камер аппарата. Видео можно записать (кнопка Record), а так же сделать фото (кнопка Capture). Сделанные фото и видео сохраняются на диске, куда установлена программа: C:\Users\User_name\Pictures\murImages

Если у вас возникли проблемы с получением изображения с аппарата, то Вам необходимо отключить Брандмауэр Windows.

#### Телеуправление с клавиатуры

Для телеуправления аппаратом с помощью клавиатуры необходимо нажать на информационную вкладку Remote [10], раскрыть меню Gamepad axes и нажать на появившуюся область.

Теперь вы можете управлять аппаратом с помощью кнопок W, A, S, D, Q, E.

#### Запуск симулятора

Запустить симулятор еще проще - достаточно нажать кнопку "Запуск симулятора" и подождать пока он откроется. Симулятор программируется точно так же как и аппарат, за исключением пары функций из pymurapi.

> **Важно**: вы не можете управлять LED лентой в симуляторе. Для получения изображений из симулятора есть специальные функции ***get_image_front*** и ***get_image_bottom***, данные функции **НЕ** работают на аппарате. Для получения видеоизображений воспользуйтесь функциями из OpenCV. Так же важно отметить, формат некоторых данных различен (показания курса, глубины). Имейте это ввиду.

#### Программирование - инициализация

Первым делом вам необходимо подключить библиотеку pymurapi. Для того, чтобы это сделать вызовите следующий код:

```Python
import pymurapi as mur
```

В дальнейшем mur будет использоваться в качестве алиаса на библиотеку pymurapi.

Далее вам необходимо создать экземпляр объекта MurApiBase. Для этого вызовите функцию mur_init():

```Python
auv = mur.mur_init()
```

> **Важно:** Функция mur_init должна вызываться только один раз! Множественные вызовы данной функции ведут к неопределенному поведению.

Все готово! Библиотека pymurapi подключена и инициализирована. Вся дальнейшая работа с аппаратом или симулятором будет происходить через объект auv.

#### Список функций и их описание

```Python
def set_on_delay(value)
# C помощью данной функции вы можете задать время, которое будет гореть LED лента на аппарате. 
# Данная функция работает только на аппарате. 
# Время задается в секундах.
# Пример использования:
auv.set_on_delay(0.5) 
```
    
```Python
def set_off_delay(value)
# C помощью данной функции вы можете задать время, которое LED лента гореть не будет. 
# Данная функция работает только на аппарате. 
# Время задается в секундах.
# Пример использования:
auv.set_off_delay(1.8) 
```

```Python
def set_rgb_color(r, g, b):
# C помощью данной функции вы можете задать цвет LED ленты в цветовом пространстве RGB.
# Данная функция работает только на аппарате. 
# Пример использования:
auv.set_rgb_color(128, 0, 64) 
```        

```Python
def set_single_led_color(led, r, g, b):
# C помощью данной функции вы можете задать цвет отдельных светодиодов на LED ленте в цветовом пространстве RGB.
# Данная функция работает только на аппаратах MiddleAUV выпущенных мая 2021 года и позже.
# На LED ленте 13 светодиодов. 0 - это номер первого светодиода, 12 - последнего. 
# Пример использования:
auv.set_single_led_color(12, 128, 0, 64) 
```

```Python
def set_motor_power(motor_id, power)
# C помощью данной функции вы можете задать тягу на моторы от -100 до 100. Где motor_id - номер мотора от 0 до 5 для аппарата и от 0 до 3 для симулятора. 
# Пример использования:
auv.set_motor_power(0, 50) 
auv.set_motor_power(1, -50) 
```
    
> **Важно:** В симуляторе моторы 0 и 1 отвечают за движение вперед/назад. Мотор 2 и 3 за всплытие/погружение. Мотор 4 за движение влево/вправо.

```Python
def get_depth()
# Данная функция возвращает значение глубины. 
# Пример использования:
depth = auv.get_depth()
```

```Python
def get_yaw()
# Данная функция возвращает значение курса. 
# Пример использования:
yaw = auv.get_yaw()
```    

```Python
def get_pitch()
# Данная функция возвращает значение крена. 
# Пример использования:
pitch = auv.get_pitch()
```        

```Python
def get_roll()
# Данная функция возвращает значение дифферента. 
# Пример использования:
roll = auv.get_roll()
```        
        
#### Функции, доступные **ТОЛЬКО** в симуляторе:

> **Важно:** Функции, приведенные ниже, доступны только в симуляторе, на аппарате данный код работать **НЕ** будет. _Мы вас предупредили_.
> 
```Python
def get_image_front()
# Даная функция возвращает изображение с передней камеры - тип cv2.Mat (BGR, CV8_UC3).
# Данная функция работает только в симуляторе. 
# Пример использования:
image = auv.get_image_front()
```

```Python
def get_image_bottom()
# Даная функция возвращает изображение с донной камеры - тип cv2.Mat (BGR, CV8_UC3).
# Данная функция работает только в симуляторе. 
# Пример использования:
image = auv.get_image_bottom()
```        

```Python
def drop()
# Вызов данной функции приведет к сбросу сферического объекта в симуляторе.
auv.drop()
```        

```Python
def shoot()
# Вызов данной функции приведет к выстрелу цилиндрическим объектом в симуляторе.
auv.shoot()
```

```Python
def open_grabber()
# Вызов данной функции приведет к раскрытию захвата в симуляторе.
auv.open_grabber()
```        

```Python
def close_grabber()
# Вызов данной функции приведет к закрытию захвата в симуляторе.
# Если в момент вызова захвата находился в контакте с объектом, то объект будет "захвачен".
auv.close_grabber()
```   

```Python
def get_hydrophone_signal():
# Данная функция возвращает сигналы с трех гидрофонов и расстояние каждого из них до гидроакустического маяка на сцене.
# Гидрофоны располагаются на переднем правом, переднем левом и на заднем правом моторе. В таком же порядке данная функция и возвращает значения.
# Каждый из гидрофонов передает информацию о том, какой маяк транслирует сигнал. Номер маяка соответствует цифре сигнала (от 1 до 5). 
# Всего может быть до пяти маяков на одной сцене.
# В настройках симулятора доступны изменения некоторых параметров транслируемого сигнала. Pulse period - период импульса, pulse width - ширина импульса, spreading speed - скорость распространения сигнала. 
tr, tl, fr, dist_tr, dist_tl, dist_fr = auv.get_hydrophone_signal()
```     

